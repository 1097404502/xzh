# creat pool 需求
要根据
1. 可用域
2. max_size
3. 用户指定的 size
三者取最小值，在和 
max(
  1,
  min(可用域,max_size,用户指定size)
)

#   ceph osd crush rule dump volumes
{
    "rule_id": 0,
    "rule_name": "volumes",
    "ruleset": 0,
    "type": 1,
    "min_size": 1,
    "max_size": 10,
    "steps": [
        {
            "op": "take",
            "item": -1,
            "item_name": "volumes"
        },
        {
            "op": "chooseleaf_firstn",
            "num": 0,
            "type": "host"
        },
        {
            "op": "emit"
        }
    ]
}




# v10 和 v14 故障域 输出对比
v10 按照 树状结构输出


# v10 ceph osd crush tree --format json
[{'id': -1,
  'items': [{'id': -2,
             'items': [{'id': -3,
                        'items': [{'id': -4,
                                   'items': [{'id': -5,
                                              'items': [{'crush_weight': 0.429993,
                                                         'depth': 5,
                                                         'id': 1,
                                                         'name': 'osd.1',
                                                         'type': 'osd',
                                                         'type_id': 0},
                                                        {'crush_weight': 0.429993,
                                                         'depth': 5,
                                                         'id': 5,
                                                         'name': 'osd.5',
                                                         'type': 'osd',
                                                         'type_id': 0}],
                                              'name': '10.0.39.2-volumes',
                                              'type': 'host',
                                              'type_id': 1},
                                             {'id': -6,
                                              'items': [{'crush_weight': 0.429993,
                                                         'depth': 5,
                                                         'id': 4,
                                                         'name': 'osd.4',
                                                         'type': 'osd',
                                                         'type_id': 0},
                                                        {'crush_weight': 0.429993,
                                                         'depth': 5,
                                                         'id': 2,
                                                         'name': 'osd.2',
                                                         'type': 'osd',
                                                         'type_id': 0}],
                                              'name': '10.0.39.3-volumes',
                                              'type': 'host',
                                              'type_id': 1},
                                             {'id': -7,
                                              'items': [{'crush_weight': 0.429993,
                                                         'depth': 5,
                                                         'id': 0,
                                                         'name': 'osd.0',
                                                         'type': 'osd',
                                                         'type_id': 0},
                                                        {'crush_weight': 0.429993,
                                                         'depth': 5,
                                                         'id': 3,
                                                         'name': 'osd.3',
                                                         'type': 'osd',
                                                         'type_id': 0}],
                                              'name': '10.0.39.1-volumes',
                                              'type': 'host',
                                              'type_id': 1}],
                                   'name': 'rack-volumes',
                                   'type': 'rack',
                                   'type_id': 3}],
                        'name': 'room-volumes',
                        'type': 'room',
                        'type_id': 7}],
             'name': 'datacenter-volumes',
             'type': 'datacenter',
             'type_id': 8}],
  'name': 'volumes',
  'type': 'root',
  'type_id': 10}]

# v14 ceph osd crush tree --format json 
{'nodes': [{'children': [-16],
            'id': -15,
            'name': 'nvme',
            'type': 'root',
            'type_id': 11},
           {'children': [-17],
            'id': -16,
            'name': 'datacenter-nvme',
            'pool_weights': {},
            'type': 'datacenter',
            'type_id': 8},
           {'children': [-18],
            'id': -17,
            'name': 'room-nvme',
            'pool_weights': {},
            'type': 'room',
            'type_id': 7},
           {'children': [-26, -25, -23],
            'id': -18,
            'name': 'rack-nvme',
            'pool_weights': {},
            'type': 'rack',
            'type_id': 3},
           {'children': [22, 21, 20, 19, 18, 17, 16, 15],
            'id': -23,
            'name': '192.168.41.1-nvme',
            'pool_weights': {},
            'type': 'host',
            'type_id': 1},
           {'crush_weight': 0.17999267578125,
            'depth': 5,
            'device_class': 'ssd',
            'id': 15,
            'name': 'osd.15',
            'pool_weights': {},
            'type': 'osd',
            'type_id': 0},
           {'crush_weight': 0.17999267578125,
            'depth': 5,
            'device_class': 'ssd',
            'id': 16,
            'name': 'osd.16',
            'pool_weights': {},
            'type': 'osd',
            'type_id': 0},
           {'crush_weight': 0.17999267578125,
            'depth': 5,
            'device_class': 'ssd',
            'id': 17,
            'name': 'osd.17',
            'pool_weights': {},
            'type': 'osd',
            'type_id': 0},
           {'crush_weight': 0.17999267578125,
            'depth': 5,
            'device_class': 'ssd',
            'id': 18,
            'name': 'osd.18',
            'pool_weights': {},
            'type': 'osd',
            'type_id': 0},
           {'crush_weight': 0.17999267578125,
            'depth': 5,
            'device_class': 'ssd',
            'id': 19,
            'name': 'osd.19',
            'pool_weights': {},
            'type': 'osd',
            'type_id': 0},
           {'crush_weight': 0.17999267578125,
            'depth': 5,
            'device_class': 'ssd',
            'id': 20,
            'name': 'osd.20',
            'pool_weights': {},
            'type': 'osd',
            'type_id': 0},
           {'crush_weight': 0.17999267578125,
            'depth': 5,
            'device_class': 'ssd',
            'id': 21,
            'name': 'osd.21',
            'pool_weights': {},
            'type': 'osd',
            'type_id': 0},
           {'crush_weight': 0.17999267578125,
            'depth': 5,
            'device_class': 'ssd',
            'id': 22,
            'name': 'osd.22',
            'pool_weights': {},
            'type': 'osd',
            'type_id': 0},
           {'children': [30, 29, 28, 27, 26, 25, 24, 23],
            'id': -25,
            'name': '192.168.41.2-nvme',
            'pool_weights': {},
            'type': 'host',
            'type_id': 1},
           {'crush_weight': 0.17999267578125,
            'depth': 5,
            'device_class': 'ssd',
            'id': 23,
            'name': 'osd.23',
            'pool_weights': {},
            'type': 'osd',
            'type_id': 0},
           {'crush_weight': 0.17999267578125,
            'depth': 5,
            'device_class': 'ssd',
            'id': 24,
            'name': 'osd.24',
            'pool_weights': {},
            'type': 'osd',
            'type_id': 0},
           {'crush_weight': 0.17999267578125,
            'depth': 5,
            'device_class': 'ssd',
            'id': 25,
            'name': 'osd.25',
            'pool_weights': {},
            'type': 'osd',
            'type_id': 0},
           {'crush_weight': 0.17999267578125,
            'depth': 5,
            'device_class': 'ssd',
            'id': 26,
            'name': 'osd.26',
            'pool_weights': {},
            'type': 'osd',
            'type_id': 0},
           {'crush_weight': 0.17999267578125,
            'depth': 5,
            'device_class': 'ssd',
            'id': 27,
            'name': 'osd.27',
            'pool_weights': {},
            'type': 'osd',
            'type_id': 0},
           {'crush_weight': 0.17999267578125,
            'depth': 5,
            'device_class': 'ssd',
            'id': 28,
            'name': 'osd.28',
            'pool_weights': {},
            'type': 'osd',
            'type_id': 0},
           {'crush_weight': 0.17999267578125,
            'depth': 5,
            'device_class': 'ssd',
            'id': 29,
            'name': 'osd.29',
            'pool_weights': {},
            'type': 'osd',
            'type_id': 0},
           {'crush_weight': 0.17999267578125,
            'depth': 5,
            'device_class': 'ssd',
            'id': 30,
            'name': 'osd.30',
            'pool_weights': {},
            'type': 'osd',
            'type_id': 0},
           {'children': [38, 37, 36, 35, 34, 33, 32, 31],
            'id': -26,
            'name': '192.168.41.3-nvme',
            'pool_weights': {},
            'type': 'host',
            'type_id': 1},
           {'crush_weight': 0.17999267578125,
            'depth': 5,
            'device_class': 'ssd',
            'id': 31,
            'name': 'osd.31',
            'pool_weights': {},
            'type': 'osd',
            'type_id': 0},
           {'crush_weight': 0.17999267578125,
            'depth': 5,
            'device_class': 'ssd',
            'id': 32,
            'name': 'osd.32',
            'pool_weights': {},
            'type': 'osd',
            'type_id': 0},
           {'crush_weight': 0.17999267578125,
            'depth': 5,
            'device_class': 'ssd',
            'id': 33,
            'name': 'osd.33',
            'pool_weights': {},
            'type': 'osd',
            'type_id': 0},
           {'crush_weight': 0.17999267578125,
            'depth': 5,
            'device_class': 'ssd',
            'id': 34,
            'name': 'osd.34',
            'pool_weights': {},
            'type': 'osd',
            'type_id': 0},
           {'crush_weight': 0.17999267578125,
            'depth': 5,
            'device_class': 'ssd',
            'id': 35,
            'name': 'osd.35',
            'pool_weights': {},
            'type': 'osd',
            'type_id': 0},
           {'crush_weight': 0.17999267578125,
            'depth': 5,
            'device_class': 'ssd',
            'id': 36,
            'name': 'osd.36',
            'pool_weights': {},
            'type': 'osd',
            'type_id': 0},
           {'crush_weight': 0.17999267578125,
            'depth': 5,
            'device_class': 'ssd',
            'id': 37,
            'name': 'osd.37',
            'pool_weights': {},
            'type': 'osd',
            'type_id': 0},
           {'crush_weight': 0.17999267578125,
            'depth': 5,
            'device_class': 'ssd',
            'id': 38,
            'name': 'osd.38',
            'pool_weights': {},
            'type': 'osd',
            'type_id': 0},
           {'children': [-2],
            'id': -1,
            'name': 'volumes',
            'type': 'root',
            'type_id': 11},
           {'children': [-5],
            'id': -2,
            'name': 'datacenter-volumes',
            'pool_weights': {},
            'type': 'datacenter',
            'type_id': 8},
           {'children': [-7],
            'id': -5,
            'name': 'room-volumes',
            'pool_weights': {},
            'type': 'room',
            'type_id': 7},
           {'children': [-11, -9, -13],
            'id': -7,
            'name': 'rack-volumes',
            'pool_weights': {},
            'type': 'rack',
            'type_id': 3},
           {'children': [12, 9, 6, 3, 0],
            'id': -13,
            'name': '192.168.41.1-volumes',
            'pool_weights': {},
            'type': 'host',
            'type_id': 1},
           {'crush_weight': 0.17999267578125,
            'depth': 5,
            'device_class': 'ssd',
            'id': 0,
            'name': 'osd.0',
            'pool_weights': {},
            'type': 'osd',
            'type_id': 0},
           {'crush_weight': 0.17999267578125,
            'depth': 5,
            'device_class': 'ssd',
            'id': 3,
            'name': 'osd.3',
            'pool_weights': {},
            'type': 'osd',
            'type_id': 0},
           {'crush_weight': 0.17999267578125,
            'depth': 5,
            'device_class': 'ssd',
            'id': 6,
            'name': 'osd.6',
            'pool_weights': {},
            'type': 'osd',
            'type_id': 0},
           {'crush_weight': 0.17999267578125,
            'depth': 5,
            'device_class': 'ssd',
            'id': 9,
            'name': 'osd.9',
            'pool_weights': {},
            'type': 'osd',
            'type_id': 0},
           {'crush_weight': 0.17999267578125,
            'depth': 5,
            'device_class': 'ssd',
            'id': 12,
            'name': 'osd.12',
            'pool_weights': {},
            'type': 'osd',
            'type_id': 0},
           {'children': [14, 10, 7, 4, 2],
            'id': -9,
            'name': '192.168.41.2-volumes',
            'pool_weights': {},
            'type': 'host',
            'type_id': 1},
           {'crush_weight': 0.17999267578125,
            'depth': 5,
            'device_class': 'ssd',
            'id': 2,
            'name': 'osd.2',
            'pool_weights': {},
            'type': 'osd',
            'type_id': 0},
           {'crush_weight': 0.17999267578125,
            'depth': 5,
            'device_class': 'ssd',
            'id': 4,
            'name': 'osd.4',
            'pool_weights': {},
            'type': 'osd',
            'type_id': 0},
           {'crush_weight': 0.17999267578125,
            'depth': 5,
            'device_class': 'ssd',
            'id': 7,
            'name': 'osd.7',
            'pool_weights': {},
            'type': 'osd',
            'type_id': 0},
           {'crush_weight': 0.17999267578125,
            'depth': 5,
            'device_class': 'ssd',
            'id': 10,
            'name': 'osd.10',
            'pool_weights': {},
            'type': 'osd',
            'type_id': 0},
           {'crush_weight': 0.17999267578125,
            'depth': 5,
            'device_class': 'ssd',
            'id': 14,
            'name': 'osd.14',
            'pool_weights': {},
            'type': 'osd',
            'type_id': 0},
           {'children': [13, 11, 8, 5, 1],
            'id': -11,
            'name': '192.168.41.3-volumes',
            'pool_weights': {},
            'type': 'host',
            'type_id': 1},
           {'crush_weight': 0.17999267578125,
            'depth': 5,
            'device_class': 'ssd',
            'id': 1,
            'name': 'osd.1',
            'pool_weights': {},
            'type': 'osd',
            'type_id': 0},
           {'crush_weight': 0.269989013671875,
            'depth': 5,
            'device_class': 'ssd',
            'id': 5,
            'name': 'osd.5',
            'pool_weights': {},
            'type': 'osd',
            'type_id': 0},
           {'crush_weight': 0.17999267578125,
            'depth': 5,
            'device_class': 'ssd',
            'id': 8,
            'name': 'osd.8',
            'pool_weights': {},
            'type': 'osd',
            'type_id': 0},
           {'crush_weight': 0.17999267578125,
            'depth': 5,
            'device_class': 'ssd',
            'id': 11,
            'name': 'osd.11',
            'pool_weights': {},
            'type': 'osd',
            'type_id': 0},
           {'crush_weight': 0.17999267578125,
            'depth': 5,
            'device_class': 'ssd',
            'id': 13,
            'name': 'osd.13',
            'pool_weights': {},
            'type': 'osd',
            'type_id': 0}],
 'stray': []}